@model List<WebApplication4.Models.CLUB>

@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewBag.Title = "Club Status";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

<style>
    .club-table {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
    }

        .club-table th, .club-table td {
            padding: 12px 15px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .club-table th {
            background-color: #004d40;
            color: white;
            font-weight: 600;
        }

        .club-table td {
            background-color: #fafafa;
        }

    .btn-filter {
        margin: 5px;
        padding: 8px 16px;
        border-radius: 5px;
        font-weight: 500;
        color: white;
        border: none;
        cursor: pointer;
    }

    .btn-warning {
        background-color: #f39c12;
    }

    .btn-success {
        background-color: #28a745;
    }

    .btn-danger {
        background-color: #dc3545;
    }

    .btn-primary {
        background-color: #007bff;
    }

    .btn-filter.active {
        box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }

    .status-pending {
        background-color: #ffc107;
        color: black;
        padding: 5px 12px;
        border-radius: 5px;
        font-weight: 500;
    }

    .status-approved {
        background-color: #28a745;
        color: white;
        padding: 5px 12px;
        border-radius: 5px;
        font-weight: 500;
    }

    .status-rejected {
        background-color: #dc3545;
        color: white;
        padding: 5px 12px;
        border-radius: 5px;
        font-weight: 500;
    }

    .reason-col {
        display: none;
    }

    @@media (max-width: 768px) {
        .btn-filter {
            padding: 6px 12px;
            font-size: 14px;
        }
    }
</style>

<div class="container mt-4">
    <!-- Heading + Filter Buttons -->
    <div class="d-flex flex-wrap align-items-center justify-content-between mb-3">
        <h2 class="mb-0">Club Status</h2>
        <div class="d-flex gap-2 flex-wrap">
            <button class="btn btn-warning btn-filter" data-status="pending">Pending Requests</button>
            <button class="btn btn-success btn-filter" data-status="approved">Approved Requests</button>
            <button class="btn btn-danger btn-filter" data-status="rejected">Rejected Requests</button>
            <button class="btn btn-primary btn-filter" data-status="all">View All Requests</button>
        </div>
    </div>

    <!-- Club Status Table -->
    <table class="club-table table table-bordered">
        <thead>
            <tr>
                <th>Club Name</th>
                <th>Description</th>
                <th>Mentor Name</th>
                <th>University</th>
                <th>Department</th>
                <th>Status</th>
                <th class="reason-col">Rejection Reason</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var club in Model)
            {
                var mentorID = (int?)club.MentorID;
                var notification = (ViewBag.Notifications as List<WebApplication4.Models.Notification>)?.FirstOrDefault(n => n.LoginID == mentorID);

                <tr class="club-row" data-status="@club.ApprovalStatusID">
                    <td>@club.ClubName</td>
                    <td>
                        @if (!string.IsNullOrEmpty(club.Description) && club.Description.Length > 10)
                        {
                            <span class="short-text">@club.Description.Substring(0, 10)...</span>
                            <span class="full-text d-none">@club.Description</span>
                            <a href="javascript:void(0);" class="see-more">See More</a>
                        }
                        else
                        {
                            @club.Description
                        }
                    </td>
                    <td>@club.MentorName</td>
                    <td>@club.DEPARTMENT.UNIVERSITY.UniversityNAME</td>
                    <td>@club.DEPARTMENT.DepartmentName</td>
                    <td>
                        @if (club.ApprovalStatusID == 1)
                        {
                            <span class="status-pending">Pending</span>
                        }
                        else if (club.ApprovalStatusID == 2)
                        {
                            <span class="status-approved">Approved</span>
                        }
                        else if (club.ApprovalStatusID == 3)
                        {
                            <span class="status-rejected">Rejected</span>
                        }
                    </td>
                    <td class="reason-col">
                        @if (club.ApprovalStatusID == 3 && notification != null)
                        {
                            @notification.Message.Replace($"Your club '{club.ClubName}' was rejected. Reason: ", "")
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination mt-4">
        <div class="pagination-info text-center mb-2">
            Showing @ViewBag.FirstItemOnPage to @ViewBag.LastItemOnPage of @ViewBag.TotalItemCount entries
        </div>
        <ul class="pagination justify-content-center">
            @for (int i = 1; i <= ViewBag.TotalPages; i++)
            {
                if (i == ViewBag.CurrentPage)
                {
                    <li class="page-item active"><span class="page-link">@i</span></li>
                }
                else
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("ClubStatus", new { page = i, status = ViewBag.CurrentStatus })">@i</a>
                    </li>
                }
            }
        </ul>
    </div>
</div>


@section Scripts {
    <script>
        jQuery(document).ready(function ($) {
            // See More / See Less
            $('.see-more').on('click', function () {
                var $td = $(this).closest('td');
                $td.find('.short-text').toggleClass('d-none');
                $td.find('.full-text').toggleClass('d-none');
                $(this).text($(this).text() === 'See More' ? 'See Less' : 'See More');
            });

            // Filter buttons
            $('.btn-filter').click(function () {
                var status = $(this).data('status');

                $('.btn-filter').removeClass('active');
                $(this).addClass('active');

                $(".club-row").hide();
                $(".reason-col").hide();

                if (status === "pending") {
                    $(".club-row[data-status='1']").show();
                } else if (status === "approved") {
                    $(".club-row[data-status='2']").show();
                } else if (status === "rejected") {
                    $(".club-row[data-status='3']").show();
                    $(".reason-col").show();
                } else {
                    $(".club-row").show();
                    $(".reason-col").show();
                }
            });

            // Trigger "View All" by default
            $('.btn-filter[data-status="all"]').click();
        });
    </script>
}


