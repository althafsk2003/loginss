@model List<WebApplication4.Models.CLUB>

@{
    Layout = "~/Views/Shared/_HodLayout.cshtml";
    ViewBag.Title = "Club Status";
}

<style>
    .club-table {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
    }

        .club-table th, .club-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .club-table th {
            background: #004d40;
            color: white;
        }

    .btn-filter {
        margin-bottom: 10px;
        cursor: pointer;
    }

    /* Status Badge Colors */
    .status-pending {
        background: #ffc107;
        color: black;
        padding: 5px 10px;
        border-radius: 5px;
    }

    .status-approved {
        background: #28a745;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
    }

    .status-rejected {
        background: #dc3545;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
    }

    .reason-col {
        display: none;
    }
    /* Hide rejection reason by default */
</style>

<div class="container mt-4">
    <!-- ✅ Heading + Filter Buttons Container -->
    <div class="d-flex align-items-center mb-3 gap-3 flex-wrap">
        <h2 class="mb-0">Club Status</h2>

        <div>
            <a href="@Url.Action("ClubStatus", new { status = 1 })" class="btn btn-warning btn-filter">Pending Requests</a>
            <a href="@Url.Action("ClubStatus", new { status = 2 })" class="btn btn-success btn-filter">Approved Requests</a>
            <a href="@Url.Action("ClubStatus", new { status = 3 })" class="btn btn-danger btn-filter">Rejected Requests</a>
            <a href="@Url.Action("ClubStatus", new { status = (int?)null })" class="btn btn-primary btn-filter">View All Requests</a>
        </div>
    </div>


    <!-- ✅ Club Status Table -->
    <table class="club-table">
        <thead>
            <tr>
                <th>Club Name</th>
                <th>Description</th>
                <th>Mentor Name</th>
                <th>University</th>
                <th>Department</th>
                <th>Status</th>
                <th class="reason-col">Rejection Reason</th> <!-- Hidden for non-rejected -->
            </tr>
        </thead>
        <tbody>
            @{
                var notifications = ViewBag.Notifications as List<WebApplication4.Models.Notification>;
            }

            @foreach (var club in Model)
            {
                var mentorID = (int?)club.MentorID;
                var notification = notifications?.FirstOrDefault(n => n.LoginID == mentorID);

                <tr class="club-row" data-status="@club.ApprovalStatusID">
                    <td>@club.ClubName</td>
                    <td>
                        <span class="short-desc">
                            @club.Description.Substring(0, Math.Min(50, club.Description.Length))@((club.Description.Length > 50) ? "..." : "")
                        </span>
                        @if (club.Description.Length > 50)
                        {
                            <span class="full-desc d-none">@club.Description</span>
                            <a href="#" class="read-more-toggle">Read more</a>
                        }
                    </td>

                    <td>@club.MentorName</td>
                    <td>@club.DEPARTMENT.UNIVERSITY.UniversityNAME</td>
                    <td>@club.DEPARTMENT.DepartmentName</td>
                    <td>
                        @if (club.ApprovalStatusID == 1)
                        {
                            <span class="status-pending">Pending</span>
                        }
                        else if (club.ApprovalStatusID == 2)
                        {
                            <span class="status-approved">Approved</span>
                        }
                        else if (club.ApprovalStatusID == 3)
                        {
                            <span class="status-rejected">Rejected</span>
                        }
                    </td>
                    <td class="reason-col">
                        @if (club.ApprovalStatusID == 3 && notification != null)
                        {
                            @notification.Message.Replace($"Your club '{club.ClubName}' was rejected. Reason: ", "")
                        }
                    </td>
                </tr>
            }

        </tbody>
    </table>
</div>

<!-- ✅ JavaScript for Filtering -->
<script>
    function filterTable(status) {
        $(".club-row").hide();
        $(".reason-col").hide(); // Hide reason column by default

        if (status === "pending") {
            $(".club-row[data-status='1']").show();
        } else if (status === "approved") {
            $(".club-row[data-status='2']").show();
        } else if (status === "rejected") {
            $(".club-row[data-status='3']").show();
            $(".reason-col").show(); // Show rejection reason
        } else {
            $(".club-row").show();
            $(".reason-col").show();
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".read-more-toggle").forEach(function (btn) {
            btn.addEventListener("click", function (e) {
                e.preventDefault();
                var shortDesc = btn.parentElement.querySelector(".short-desc");
                var fullDesc = btn.parentElement.querySelector(".full-desc");

                if (fullDesc.classList.contains("d-none")) {
                    shortDesc.classList.add("d-none");
                    fullDesc.classList.remove("d-none");
                    btn.textContent = "Read less";
                } else {
                    fullDesc.classList.add("d-none");
                    shortDesc.classList.remove("d-none");
                    btn.textContent = "Read more";
                }
            });
        });
    });
</script>

<div class="mt-4">
    <div class="text-center mb-2">
        <span class="text-muted">
            Showing @ViewBag.FirstItemOnPage to @ViewBag.LastItemOnPage of @ViewBag.TotalItemCount entries
        </span>
    </div>

    <nav>
        <ul class="pagination justify-content-center">
            @for (int i = 1; i <= ViewBag.TotalPages; i++)
            {
                if (i == ViewBag.CurrentPage)
                {
                    <li class="page-item active" aria-current="page">
                        <span class="page-link">@i</span>
                    </li>
                }
                else
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("ClubStatus", new { page = i, status = ViewBag.CurrentStatus })">@i</a>
                    </li>
                }
            }
        </ul>
    </nav>
</div>




<style>
    .club-table {
        width: 100%;
        background-color: #fff;
        border-collapse: collapse;
        border-radius: 6px;
        overflow: hidden;
        margin-top: 10px;
        font-size: 14px;
    }

        .club-table th,
        .club-table td {
            padding: 6px 10px;
            border: 1px solid #ccc;
            text-align: left;
        }

        .club-table th {
            background-color: #004d40;
            color: white;
            font-weight: 600;
        }

        .club-table td {
            background-color: #f8f8f8;
        }

    .btn-filter {
        margin: 6px 4px;
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 13px;
        font-weight: 500;
        color: white;
        border: none;
    }

    .btn-warning {
        background-color: #f39c12;
    }

        .btn-warning:hover {
            background-color: #e67e22;
        }

    .btn-success {
        background-color: #28a745;
    }

        .btn-success:hover {
            background-color: #218838;
        }

    .btn-danger {
        background-color: #dc3545;
    }

        .btn-danger:hover {
            background-color: #c82333;
        }

    .btn-primary {
        background-color: #007bff;
    }

        .btn-primary:hover {
            background-color: #0056b3;
        }

    .pagination-container {
        margin: 20px 0 5px;
    }

    .pagination-info {
        font-size: 13px;
        color: #6c757d;
        margin-bottom: 5px;
    }

    .pagination {
        gap: 6px;
        flex-wrap: wrap;
    }

    .page-link {
        padding: 8px 10px;
        border-radius: 4px;
        background-color: #e0e0e0;
        color: black;
        font-size: 13px;
        text-decoration: none;
    }

        .page-link:hover,
        .page-item.active .page-link {
            background-color: #007bff;
            color: white;
        }

    .status-pending,
    .status-approved,
    .status-rejected {
        padding: 3px 8px;
        font-size: 13px;
        border-radius: 4px;
        font-weight: 500;
    }

    .status-pending {
        background-color: #ffc107;
        color: black;
    }

    .status-approved {
        background-color: #28a745;
        color: white;
    }

    .status-rejected {
        background-color: #dc3545;
        color: white;
    }

    .reason-col {
        display: none;
    }

    .read-more-toggle {
        font-size: 13px;
        margin-left: 3px;
        color: #007bff;
        text-decoration: underline;
        cursor: pointer;
    }

    .d-none {
        display: none;
    }

    @@media (max-width: 768px) {
        .club-table th,
        .club-table td {
            font-size: 12px;
            padding: 4px 8px;
        }

        .btn-filter {
            font-size: 12px;
            padding: 5px 10px;
        }

        .page-link {
            padding: 6px 8px;
            font-size: 12px;
        }

        .status-pending,
        .status-approved,
        .status-rejected {
            font-size: 12px;
            padding: 2px 6px;
        }
    }
</style>
