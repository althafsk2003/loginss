@model WebApplication4.Models.SubHODEventReviewViewModel

@{
    Layout = "~/Views/Shared/_SubHODLayout.cshtml";
}

<h2 class="mb-4 text-center text-primary">Review Event Requests</h2>

<div class="container">
    @using (Html.BeginForm("ViewEventRequests", "SubHOD", FormMethod.Post))
    {
        <div class="form-inline justify-content-center mb-4">
            <label for="SelectedClubId" class="mr-2 font-weight-bold">Select Club:</label>
            @Html.DropDownListFor(m => m.SelectedClubId, Model.ActiveClubs, "Select a club", new
            {
                @class = "form-control form-control-sm w-auto",
                onchange = "this.form.submit();"
            })
        </div>
    }

    @if (Model.Events != null && Model.Events.Any())
    {
        <div id="eventCarousel" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                @for (int i = 0; i < Model.Events.Count; i++)
                {
                    var evt = Model.Events[i];
                    <div class="carousel-item @(i == 0 ? "active" : "")">
                        <div class="card mx-auto mt-3 shadow-sm" style="width: 38rem; border-radius: 16px;">
                            <img src="@Url.Content(evt.EventPoster ?? "~/Content/Images/no-poster.png")"
                                 class="card-img-top"
                                 alt="Event Poster"
                                 style="max-height: 250px; object-fit: cover; border-top-left-radius: 16px; border-top-right-radius: 16px;" />
                            <div class="card-body">
                                <h5 class="card-title text-primary">@evt.EventName</h5>
                                <p class="card-text">
                                    <span class="short-desc">
                                        @(evt.EventDescription?.Length > 150
                                            ? evt.EventDescription.Substring(0, 150) + "..."
                                            : evt.EventDescription)
                                    </span>
                                    <span class="full-desc d-none">@evt.EventDescription</span>
                                    @if (!string.IsNullOrEmpty(evt.EventDescription) && evt.EventDescription.Length > 150)
                                    {
                                        <a href="javascript:void(0);" class="toggle-desc text-primary ml-1">See more</a>
                                    }
                                </p>
                                <p><strong>Start:</strong> @evt.EventStartDateAndTime.ToString("dd MMM yyyy")</p>
                                <p><strong>End:</strong> @evt.EventEndDateAndTime.ToString("dd MMM yyyy")</p>
                                <p>
                                    <strong>Budget Document:</strong>
                                    @if (!string.IsNullOrEmpty(evt.BudgetDocumentPath))
                                    {
                                        <a href="@Url.Content(evt.BudgetDocumentPath)" target="_blank">Download</a>
                                    }
                                    else
                                    {
                                        <span>No document uploaded</span>
                                    }
                                </p>

                                <div class="mt-3">
                                    @using (Html.BeginForm("ForwardToDirector", "SubHOD", FormMethod.Post, new { @class = "d-inline" }))
                                    {
                                        @Html.Hidden("eventId", evt.EventID)
                                        <button type="submit" class="btn btn-sm btn-success">Forward to Director</button>
                                    }

                                    <button type="button" class="btn btn-sm btn-danger ml-2" onclick="showRejectModal(@evt.EventID)">Reject with Reason</button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <a class="carousel-control-prev" href="#eventCarousel" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#eventCarousel" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    }
    else if (Model.SelectedClubId != 0)
    {
        <div class="alert alert-info text-center">No events found for this club.</div>
    }
</div>

<!-- Reject Modal -->
<div class="modal fade" id="rejectModal" tabindex="-1" role="dialog" aria-labelledby="rejectModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        @using (Html.BeginForm("RejectEvent", "SubHOD", FormMethod.Post))
        {
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="rejectModalLabel">Reject Event</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    @Html.Hidden("eventId", "", new { id = "rejectEventId" })
                    <div class="form-group">
                        <label for="RejectReason">Reason for rejection:</label>
                        <textarea id="RejectReason" name="reason" class="form-control" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-danger">Reject</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        function showRejectModal(eventId) {
            $('#rejectEventId').val(eventId);
            $('#rejectModal').modal('show');
        }

        $(document).ready(function () {
            $('.toggle-desc').on('click', function () {
                var $link = $(this);
                var $cardText = $link.closest('.card-text');

                $cardText.find('.short-desc').toggleClass('d-none');
                $cardText.find('.full-desc').toggleClass('d-none');

                $link.text($link.text().trim() === 'See more' ? 'See less' : 'See more');
            });
        });
    </script>
}

@section Styles {
    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            background-color: #f5f8fa;
        }

        h2 {
            font-size: 34px;
            font-weight: 600;
        }

        .form-inline label {
            font-size: 20px;
        }

        .form-inline .form-control-sm {
            width: 220px;
        }

        .card {
            border-radius: 16px;
            border: 1px solid #dee2e6;
            margin: 0 auto;
        }

        .carousel-control-prev,
        .carousel-control-next {
            width: 40px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 1;
        }

        .carousel-control-prev {
            left: 150px;
        }

        .carousel-control-next {
            right: 150px;
        }

        .carousel-control-prev-icon,
        .carousel-control-next-icon {
            background-color: #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            background-size: 50% 50%;
            background-repeat: no-repeat;
            background-position: center;
        }

        .carousel-inner {
            padding: 0;
        }

        .container {
            padding-left: 0;
            padding-right: 0;
        }

        .toggle-desc {
            cursor: pointer;
            font-weight: 500;
        }
    </style>
}
