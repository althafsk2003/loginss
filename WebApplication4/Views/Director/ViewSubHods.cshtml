@model WebApplication4.Models.SubHodDashboardViewModel
@{
    ViewBag.Title = "Sub-HOD Management";
    Layout = "~/Views/Shared/DirectorLayout.cshtml";
}

<style>
    /* Keep header fixed during scroll */
    .table-responsive {
        max-height: 350px;
        overflow-y: auto;
    }

    .table thead th {
        position: sticky;
        top: 0;
        background-color: #004085; /* Deep blue for header */
        color: white;
        z-index: 2;
    }

    /* Zebra striping */
    .table tbody tr:nth-child(odd) {
        background-color: #f9f9f9;
    }

    /* Hover effect */
    .table tbody tr:hover {
        background-color: #e2e6ea;
    }

    /* Filter buttons spacing */
    .btn-group .btn {
        margin-right: 5px;
    }

    /* Badge style */
    .badge {
        font-size: 0.9rem;
    }

    /* Card styling */
    .card {
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #ddd;
    }

    /* Heading above table */
    .table-heading {
        margin-bottom: 15px;
        font-size: 1.5rem;
        font-weight: bold;
        color: #004085;
    }
</style>

<div class="container mt-4">

    <!-- Heading and Filter Buttons in the same row -->
    <div class="d-flex mb-3">
        <div class="table-heading">
            View SCC
        </div>

        <div class="btn-group">
            <a href="@Url.Action("ViewSubHods", new { filter = "manage" })" class="btn btn-primary me-2 shadow-sm">
                Manage Sub-HODs
            </a>
            <a href="@Url.Action("ViewSubHods", new { filter = "all" })" class="btn btn-secondary me-2 shadow-sm">
                All Sub-HODs <span class="badge bg-light text-dark">@Model.TotalCount</span>
            </a>
            <a href="@Url.Action("ViewSubHods", new { filter = "active" })" class="btn btn-success me-2 shadow-sm">
                Active <span class="badge bg-light text-dark">@Model.ActiveCount</span>
            </a>
            <a href="@Url.Action("ViewSubHods", new { filter = "inactive" })" class="btn btn-danger shadow-sm">
                Inactive <span class="badge bg-light text-dark">@Model.InactiveCount</span>
            </a>
        </div>
    </div>

    <!-- Table -->
    <div class="card shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-bordered table-hover m-0">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Department</th>
                            <th>Sub Department</th>
                            <th>Status</th>
                            @if (Model.ShowToggle)
                            {
                                <th>Action</th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var hod in Model.TableData)
                        {
                            <tr>
                                <td>@hod.HODName</td>
                                <td>@hod.HODEmail</td>
                                <td>@hod.DepartmentName</td>
                                <td>@hod.SubDepartmentName</td>
                                <td id="status-@hod.SubDepartmentId" class="fw-bold text-@(hod.IsActive ? "success" : "danger")">
                                    @(hod.IsActive ? "Active" : "Inactive")
                                </td>
                                @if (Model.ShowToggle)
                                {
                                    <td>
                                        @if (hod.IsActive)
                                        {
                                            <button class="btn btn-danger btn-sm toggle-btn"
                                                    data-id="@hod.SubDepartmentId"
                                                    data-active="false">
                                                Deactivate
                                            </button>
                                        }
                                        else
                                        {
                                            <button class="btn btn-success btn-sm toggle-btn"
                                                    data-id="@hod.SubDepartmentId"
                                                    data-active="true">
                                                Activate
                                            </button>
                                        }
                                    </td>
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


@section scripts {
    <script>
$(document).ready(function () {
    $(document).on("click", ".toggle-btn", function () {
        var btn = $(this);
        var id = btn.data("id");
        var isActive = btn.data("active");
        var actionText = isActive ? "activate" : "deactivate";

        if (confirm("Are you sure you want to " + actionText + " this Sub-HOD?")) {
            $.post('@Url.Action("ToggleSubHodStatus", "Director")',
                { subDeptId: id, isActive: isActive },
                function (response) {
                    if (response.success) {
                        var row = btn.closest("tr");
                        var statusTd = row.find("td[id='status-" + id + "']");
                        statusTd.text(isActive ? "Active" : "Inactive")
                                .removeClass("text-success text-danger")
                                .addClass(isActive ? "text-success" : "text-danger");

                        if (isActive) {
                            btn.removeClass("btn-success")
                               .addClass("btn-danger")
                               .text("Deactivate")
                               .data("active", false);
                        } else {
                            btn.removeClass("btn-danger")
                               .addClass("btn-success")
                               .text("Activate")
                               .data("active", true);
                        }
                    } else {
                        alert(response.message);
                    }
                });
        }
    });
});
    </script>
}
