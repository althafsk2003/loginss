@using WebApplication4.Models
@using Newtonsoft.Json
@Html.AntiForgeryToken()
@{
    Layout = "~/Views/Shared/_MentorLayout.cshtml";
    ViewBag.Title = "Mentor Dashboard";

    var clubNames = ViewBag.ClubNames as List<string> ?? new List<string> { "No Clubs" };
    var eventCounts = ViewBag.EventCounts as List<int> ?? new List<int> { 0 };
    var mentorEventNotifications = ViewBag.MentorEventNotifications as List<MentorEventNotification>
                                   ?? new List<MentorEventNotification>();
}

<div class="container mt-3">
    <div class="row d-flex align-items-stretch">
        <!-- Left Column: Mentor Profile -->
        <div class="col-lg-3 col-md-12 mb-4 d-flex">
            <div class="card shadow-lg border-0 hover-card mentor-card flex-fill">
                <div class="card-body position-relative">
                    <div class="avatar-circle mx-auto mb-3">
                        <i class="fas fa-user fa-2x text-white"></i>
                    </div>
                    <h4 class="card-title text-primary mb-2">@ViewBag.MentorFullName</h4>
                    <div class="text-left">
                        <p class="mb-2"><i class="fas fa-envelope me-2 text-primary"></i><strong>Email:</strong> @ViewBag.Mentor.Email</p>
                        <p class="mb-2"><i class="fas fa-university me-2 text-primary"></i><strong>University:</strong> @ViewBag.UniversityName</p>

                        @if (!string.IsNullOrEmpty(ViewBag.SubDepartmentName))
                        {
                            <p class="mb-2"><i class="fas fa-sitemap me-2 text-primary"></i><strong>Sub-Department:</strong> @ViewBag.SubDepartmentName</p>
                        }

                        @if (!string.IsNullOrEmpty(ViewBag.DepartmentName))
                        {
                            <p class="mb-2"><i class="fas fa-building me-2 text-primary"></i><strong>Department:</strong> @ViewBag.DepartmentName</p>
                        }

                        @if (ViewBag.SubHOD != null)
                        {
                            <p class="mb-2"><i class="fas fa-user-tie me-2 text-primary"></i><strong>Sub-HOD:</strong> @ViewBag.SubHOD.FirstName @ViewBag.SubHOD.LastName</p>
                        }

                        @if (ViewBag.HOD != null)
                        {
                            <p class="mb-2"><i class="fas fa-user-tie me-2 text-primary"></i><strong>HOD:</strong> @ViewBag.HOD.FirstName @ViewBag.HOD.LastName</p>
                        }

                        @if (ViewBag.Director != null)
                        {
                            <p class="mb-2"><i class="fas fa-chalkboard-teacher me-2 text-primary"></i><strong>Director:</strong> @ViewBag.Director.FirstName @ViewBag.Director.LastName</p>
                        }

                        <p class="mb-2"><i class="fas fa-users me-2 text-primary"></i><strong>Total Clubs:</strong> @ViewBag.ClubsCount</p>
                        <p class="mb-2"><i class="fas fa-calendar-check me-2 text-primary"></i><strong>Total Events:</strong> @ViewBag.EventsCount</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle Column: Chart -->
        <div class="col-lg-6 col-md-12 mb-4 d-flex">
            <div class="card shadow-sm p-4 border-0 chart-card flex-fill">
                <h4 class="text-center mb-2">Clubs and Their Events</h4>
                <div class="chart-container">
                    <canvas id="clubEventChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Right Column: Notifications -->
        <div class="col-lg-3 col-md-12 mb-4 d-flex">
            <div class="card shadow-sm border-0 hover-card flex-fill">
                <div class="card-body">
                    <h5 class="card-title text-primary">Event Notifications</h5>
                    @if (mentorEventNotifications.Any())
                    {
                        <ul class="list-group list-group-flush" style="max-height: 450px; overflow-y: auto;">
                            @foreach (var n in mentorEventNotifications)
                            {
                                <li class="list-group-item">
                                    <a href="@n.Url" class="notification-link">
                                       Event @n.EventName - <span class="fw-bold">@n.Message</span>
                                    </a>
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p class="text-muted">No pending event actions</p>
                    }
                </div>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const clubLabelsRaw = '@Html.Raw(JsonConvert.SerializeObject(clubNames))';
            const eventDataRaw = '@Html.Raw(JsonConvert.SerializeObject(eventCounts))';

            let clubLabels = [], eventData = [];

            try {
                clubLabels = JSON.parse(clubLabelsRaw);
                eventData = JSON.parse(eventDataRaw);
            } catch (e) {
                console.error('JSON Parse Error:', e.message);
            }

            if (!Array.isArray(clubLabels) || !Array.isArray(eventData) || clubLabels.length !== eventData.length) {
                clubLabels = ['No Clubs'];
                eventData = [0];
            }

            const ctx = document.getElementById('clubEventChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: clubLabels,
                    datasets: [{
                        label: 'All Events',
                        data: eventData,
                        backgroundColor: 'rgba(74, 0, 224, 0.6)',
                        borderColor: 'rgba(74, 0, 224, 1)',
                        borderWidth: 1,
                        hoverBackgroundColor: 'rgba(142, 45, 226, 0.8)',
                        hoverBorderColor: 'rgba(142, 45, 226, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Event Count' } },
                        x: { title: { display: true, text: 'Clubs' } }
                    }
                }
            });
        });
    </script>
}

@section Styles {
    <style>
        :root {
            --primary-gradient-start: #4a00e0;
            --primary-gradient-end: #8e2de2;
            --secondary-color: #f7f9fc;
            --text-primary: #2d2d2d;
            --text-secondary: #6c757d;
            --accent-color: #ff6f61;
            --shadow-color: rgba(0, 0, 0, 0.15);
        }

        .mentor-card, .hover-card {
            border-radius: 16px;
            transition: transform 0.4s ease, box-shadow 0.4s ease;
        }

            .hover-card:hover {
                transform: translateY(-8px) scale(1.03);
                box-shadow: 0 12px 24px var(--shadow-color) !important;
            }

        .mentor-card {
            background: linear-gradient(145deg, var(--secondary-color), #ffffff);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .avatar-circle {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: 2px solid #ffffff;
            margin: 0 auto 15px;
        }

        .card-title {
            font-weight: 700;
            font-size: 1.5rem;
            letter-spacing: 0.8px;
            color: var(--primary-gradient-start);
        }

        .chart-card {
            background: linear-gradient(145deg, #ffffff, var(--secondary-color));
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
        }

        .chart-container {
            width: 100%;
            height: 450px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
        }

        #clubEventChart {
            width: 100%;
            height: 450px !important;
        }

        @@media (max-width: 991px) {
            .avatar-circle {
                width: 65px;
                height: 65px;
            }

                .avatar-circle i {
                    font-size: 1.8rem;
                }

            .card-title {
                font-size: 1.3rem;
            }

            .chart-container, #clubEventChart {
                height: 320px;
            }
        }
        .notification-link {
            color: #4a00e0; /* Choose your color */
            font-weight: 500;
            text-decoration: none;
            transition: color 0.3s ease;
        }

            .notification-link:hover {
                color: #8e2de2; /* Hover color */
                text-decoration: underline;
            }


    </style>
}
